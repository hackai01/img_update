name: CIS-CICD

on: push

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      
      - name: Login to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}


      - name: Create virtual machine
        run: |
          az vm create \
            --resource-group Test \
            --name wazuh-agent-test-NX \
            --image UbuntuLTS \
            --admin-username azureuser \
            --admin-password Password@123\
            --size Standard_B2s \
            --storage-sku Standard_LRS \
            --data-disk-sizes-gb 50 \
            --public-ip-address-allocation static \
            --nsg-rule SSH \
            --output table

      - name: Update & Patch
        run: |
          sudo apt -y update && sudo apt -y upgrade
          
      - name: Install NGINX
        run: |
          sudo apt -y install nginx
